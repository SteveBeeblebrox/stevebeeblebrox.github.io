var Magma;!function(e){let n;!function(e){e[e.SCRIPT=0]="SCRIPT",e[e.JSON=1]="JSON"}(n=e.Mode||(e.Mode={})),e.transpile=async function(e,{spacesToTabs:n=0,macros:s=new Map}={},l=eval){var i,t,o,a,r,c,d,p;const u="\\",f=new Map,g=["execute"],v=[],m=[];let h;n&&(e=e.replaceAll(" ".repeat(n),"\t")),s=new Map([...s.entries()].filter((([e])=>/^[A-Z_]*$/.test(e)))),e.replace(/(?:(?:(?<!\\)(?:\\{2})*\\\n)|[^\n])*/g,(e=>m.push(e).toString()));for(const e of m){let n;if(n=/^\s*?##\s*?(?:define|def)\s*?(?<macro>[A-Z_]+)(?: (?<value>(?:(?:(?<!\\)(?:\\{2})*\\\n)|[^\n])*))?/gm.exec(e))s.set(n.groups.macro,null!==(o=null===(t=null===(i=n.groups.value)||void 0===i?void 0:i.replace(/\\(?=\n)/g,""))||void 0===t?void 0:t.replaceAll(u.repeat(2),u))&&void 0!==o?o:"");else if(n=/^\s*?##\s*?un(?:define|def)\s*?(?<macro>[A-Z_]+)\s*?$/gm.exec(e))s.delete(n.groups.macro);else if(n=/^(?<whitespace>\s*?)##\s*?(?:js|javascript)\s*?(?<value>[\s\S]*)/gm.exec(e))(null!==(p=await l(null!==(d=null===(c=null===(r=null===(a=n.groups)||void 0===a?void 0:a.value)||void 0===r?void 0:r.replace(/\\(?=\n)/g,""))||void 0===c?void 0:c.replaceAll(u.repeat(2),u))&&void 0!==d?d:""))&&void 0!==p?p:"").toString().split(/\n/g).forEach((e=>x(n.groups.whitespace+e)));else if(n=/^\s*?##\s*?if(?:def|defined)\s*?(?<macro>[A-Z_]+)\s*?$/gm.exec(e))v.push((()=>[...s.keys()].includes(n.groups.macro)));else if(n=/^\s*?##\s*?ifun(?:def|defined)\s*?(?<macro>[A-Z_]+)\s*?$/gm.exec(e))v.push((()=>![...s.keys()].includes(n.groups.macro)));else if(n=/^\s*?##\s*?endif\s*?$/gm.exec(e))v.pop();else{if(n=/^\s*?##[\s\S]*/gm.exec(e))throw`Unexpected macro instruction "${n[0]}" on line ${m.slice(0,m.indexOf(e)).reduce(((e,n)=>e+n.split(/\n/g).length),0)}`;v.every((e=>e()))&&x([...s.entries()].reduce(((e,[n,s])=>e.replaceAll(n,s)),e).replace(/\\\n/g,"").replaceAll(u.repeat(2),u))}}function x(e){var n,s,l;let i,t=null!==(l=null===(s=null===(n=/^\t*/.exec(e))||void 0===n?void 0:n[0])||void 0===s?void 0:s.length)&&void 0!==l?l:0;if(!/^(?:\s*$)|(\s*?#)/g.test(e))if(0===t){if(!(i=/^fn (?<name>[a-z_]+):/.exec(e)))throw`Indentation level ${t} may only contain function declarations.`;h=i.groups.name,f.set(h,[]),g.splice(1,g.length-1)}else{if(!h)throw"Unexpected instruction before function declaration";if(i=/^(?<tabs>\t*?)(?<what>(?:align|anchored|as|at|facing|in|positioned|rotated|store|if|unless)[\s\S]*):\s*?$/gm.exec(e))g.splice(t,g.length-t,i.groups.what);else{if(g.splice(t,g.length),g.length<t)throw`Unexpected indentation level ${t}`;f.get(h).push(g.length>1?`${[...g,"run"].join(" ")} ${e.trim()}`:e.trim())}}}return new Map([...f.entries()].map((([e,n])=>[e,n.join("\n")])))}}(Magma||(Magma={}));