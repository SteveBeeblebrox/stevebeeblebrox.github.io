var VFS;!function(e){let t;!function(e){e.getByIndex=function(e,t){return!!((e>>t-1)%2)},e.get=function(e,t){return!!(e&t)},e.setByIndex=function(e,t,s=!0){const r=1<<t-1;return s?e|r:e&~r},e.set=function(e,t,s=!0){return s?e|t:e&~t}}(t||(t={}));const s=Symbol("getBase"),r=()=>new Date,i=e=>e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&"),n=t.get,o=t.set;class a extends Error{constructor(e){var t;super(null!==(t="Assertion failed"+(e?": ":"")+e)&&void 0!==t?t:"")}}function c(e,t=""){if(!e)throw new a(t)}let l,u;e.assert=c,function(e){class t{constructor(e,t,s,r,i,n){this.name=e,this.dateCreated=t,this.dateModified=s,this.dateAccessed=r,this.permissions=i,this.attributes=n,this.parentDirectory=null}toObject(){return{type:this.constructor.name,name:this.name,dateCreated:+this.dateCreated,dateModified:+this.dateModified,dateAccessed:+this.dateAccessed,permissions:this.permissions,attributes:this.attributes}}}e.AbstractFile=t;class s extends t{constructor(e,t,s,r,i,n,o){super(e,t,s,r,n,o),this.data=i,this.lockMode=d.LockMode.UNLOCKED}get contentSize(){return this.data.byteLength}async locked(e,t){const r={};this.lockMode=e,this.lockObject=r;try{await t(new Proxy(this,{get(e,t){switch(t){case s.prototype.read.name:return function(){return e.read(r)};case s.prototype.write.name:return function(t,s,i){return e.write(t,s,i,r)};default:return Reflect.get(e,t)}}}))}finally{this.lockMode=d.LockMode.UNLOCKED,this.lockObject=void 0}}toObject(){return Object.assign(super.toObject(),{data:(new TextDecoder).decode(this.data)})}static fromObject(e){return c(e.type===s.name,"Unable restore file from object that is not a file representation"),new s(e.name,e.dateCreated,e.dateModified,e.dateAccessed,(new TextEncoder).encode(e.data),e.permissions,e.attributes)}read(e){return this.assertUnlocked(d.LockMode.READ,e),this.dateAccessed=r(),structuredClone(this.data)}write(e,t,s,i){this.assertUnlocked(d.LockMode.WRITE,i);const n=s?t+e.byteLength:Math.max((null!=t?t:this.data.byteLength)+e.byteLength,this.data.byteLength),o=new Uint8Array(n);o.set(new Uint8Array(this.data).slice(0,n),0),o.set(new Uint8Array(e),null!=t?t:this.data.byteLength),this.dateModified=r(),this.data=o.buffer}assertUnlocked(e,t){c(this.lockMode<e||this.lockObject===t,`Cannot ${d.LockMode[e].toLowerCase()} ${e==d.LockMode.WRITE?"to":"from"} ${d.LockMode[this.lockMode].toLowerCase()} locked file.`)}}e.File=s;class i extends t{constructor(e,t,s,r,i,n,o,a,c=!1){super(e,t,s,r,i,n),this.names=o,this.files=a,this.isRoot=c}toObject(){return Object.assign(super.toObject(),{files:this.files.map((e=>e.toObject())),isRoot:this.isRoot})}static fromObject(e){return c(e.type===i.name,"Unable restore directory from object that is not a directory representation"),new i(e.name,e.dateCreated,e.dateModified,e.dateAccessed,e.permissions,e.attributes,e.files.map((e=>e.name)),e.files.map((e=>e.type===i.name?i.fromObject(e):s.fromObject(e))),e.isRoot)}get(e){return this.files[this.getNameIndex(e)]}set(e,t){return c(null!==e,"Cannot add a nameless file to a directory"),c(null===t.parentDirectory,"A file cannot be in multiple directories"),c(!(t instanceof i&&t.isRoot),"The root directory cannot be moved"),this.has(e)?this.get(e):(this.files[(this.getWritableNameIndex(e,!0)+1||this.names.push(e))-1]=t,t.name=e,t.parentDirectory=this,t)}has(e){return this.names.includes(e)}delete(e){let t;this.names.splice(t=this.getWritableNameIndex(e),1);const s=this.files.splice(t,1)[0];return s.name=null,s.parentDirectory=null,s}keys(e=!1,t=!1){const s=[];return t&&s.push("."),t&&null!==this.parentDirectory&&s.push(".."),e?[...s,...this.names]:[...s,...[...this.names].filter((e=>!n(this.files[this.getNameIndex(e)].attributes,d.Attributes.HIDDEN)))]}getNameIndex(e,t=!0){this.assertValidName(e);const s=this.names.indexOf(e);return t&&c(s>=0,`File '${e}' does not exist or is not readable.`),this.dateAccessed=r(),s}getWritableNameIndex(e,t=!1){const s=this.getNameIndex(e,!t);return this.dateModified=r(),s}assertValidName(e){c(![".",".."].includes(e),`Cannot name file with reserved name '${e}'`)}}e.Directory=i}(l||(l={}));class d{constructor(e,t){this.root=e,this.PATH_SEPARATOR=t}static new(e="/",t){return new d(null!=t?t:new l.Directory(null,r(),r(),r(),d.Permissions.READ|d.Permissions.WRITE|d.Permissions.EXECUTE,0,[],[],!0),e)}createInterface({homeDir:e=this.PATH_SEPARATOR,unrestricted:t=!1}={}){const a=this.PATH_SEPARATOR;class u{constructor(e){this.base=e,this.PATH_SEPERATOR=a}wrap(e){return e instanceof l.Directory?new m(e):new h(e)}get[Symbol.toStringTag](){return this.constructor.name}getName(){return this.base.name}getDateCreated(){return this.base.dateCreated}getDateModified(){return this.base.dateModified}getDateAccessed(){return this.base.dateAccessed}getParentDirectory(){return this.base.parentDirectory?new m(this.base.parentDirectory):null}getAttributes(){return this.base.attributes}setAttributes(e){if(this.assertPermission(d.Permissions.WRITE),"object"==typeof e){for(const[t,s]of Object.entries(e))o(this.base.attributes,Reflect.get(d.Attributes,t),s);return this.base.attributes}return this.base.attributes="function"==typeof e?e(this.base.attributes):e}getPermissions(){return this.base.permissions}setPermissions(e){if(c(t,"Unrestricted access is needed to set permissions"),"object"==typeof e){for(const[t,s]of Object.entries(e))this.base.permissions=o(this.base.permissions,Reflect.get(d.Permissions,t),s);return this.base.permissions}return this.base.permissions="function"==typeof e?e(this.base.permissions):e}isExecutable(){return n(this.base.permissions,d.Permissions.EXECUTE)}[s](e){return c(e===s),this.base}assertPermission(e,s=this.base){var r;c(t||n(s.permissions,e),`File '${null!==(r=s.name)&&void 0!==r?r:"<unknown>"} is not ${d.Permissions[e].toLowerCase().replace(/[aeiou]$/,"")}able.'`)}}class h extends u{constructor(e){super(e),this.base=e,this.encoder=new TextEncoder,this.decoder=new TextDecoder}static new(){return new h(new l.File(null,r(),r(),r(),new ArrayBuffer(0),d.Permissions.READ|d.Permissions.WRITE,0))}read(e=!1){this.assertPermission(d.Permissions.READ);const t=this.base.read();return e?this.decoder.decode(t):t}write(e,t,s){this.assertPermission(d.Permissions.WRITE),"string"==typeof e&&(e=this.encoder.encode(e)),this.base.write(e,t,s)}getContentSize(){return this.assertPermission(d.Permissions.READ),this.base.contentSize}locked(e,t){return this.assertPermission(d.Permissions.WRITE),this.base.locked(e,(e=>t(new h(e))))}}class m extends u{constructor(e){super(e),this.base=e}static new(e){return new m(null!=e?e:new l.Directory(null,r(),r(),r(),d.Permissions.READ|d.Permissions.WRITE|d.Permissions.EXECUTE,0,[],[]))}splitfp(t){return"string"==typeof t&&"~"===(t=t.replace(new RegExp(String.raw`${i(a)}$`,"g"),"").split(new RegExp(String.raw`(?<!^)${i(a)}|(?<=^${i(a)})`,"g")))[0]&&t.splice(0,1,...this.splitfp(e)),t}get(e){var t;this.assertPermission(d.Permissions.READ);const[s,...r]=this.splitfp(e),i=(()=>{switch(s){case".":return this;case"..":return c(null!==this.getParentDirectory,"Directory has no parent"),this.getParentDirectory();case a:return b;default:return this.wrap(this.base.get(s))}})();return r.length?(c(i instanceof m,`Cannot resolve path. Expected a directory but found a file: '${null!==(t=null==i?void 0:i.getName())&&void 0!==t?t:"<none>"}'`),i.get(r)):i}set(e,t){var r,i;this.assertPermission(d.Permissions.WRITE);const{target:n,last:o}=this.preparePath(e);c(n instanceof m,`Cannot set '${o}' since ${null!==(i=null===(r=null==n?void 0:n.getName)||void 0===r?void 0:r.call(n))&&void 0!==i?i:"<unknown>"} is not a directory`),n.has(o)&&n.assertPermission(d.Permissions.WRITE,n.get(o)[s](s));const a=n.base.set(o,t[s](s));return this.wrap(a)}has(e,t=!0){const s=()=>{var t,s;this.assertPermission(d.Permissions.READ);const{target:r,last:i}=this.preparePath(e);return c(r instanceof m,`Cannot check if '${i}' exists since ${null!==(s=null===(t=null==r?void 0:r.getName)||void 0===t?void 0:t.call(r))&&void 0!==s?s:"<unknown>"} is not a directory`),r.base.has(i)};if(!t)return s();try{return s()}catch{return!1}}typeof(e,t=!0){const s=()=>(this.assertPermission(d.Permissions.READ),this.get(e).constructor.name);if(!t)return s();try{return s()}catch{return"undefined"}}delete(e){var t,s;this.assertPermission(d.Permissions.WRITE);const{target:r,last:i}=this.preparePath(e);return c(r instanceof m,`Cannot delete '${i}' exists since ${null!==(s=null===(t=null==r?void 0:r.getName)||void 0===t?void 0:t.call(r))&&void 0!==s?s:"<unknown>"} is not a directory`),this.wrap(r.base.delete(i))}keys({includeHidden:e=!1,includeSpecial:t=!1}={}){return this.assertPermission(d.Permissions.READ),this.base.keys(e,t)}isRoot(){return this.base.isRoot}preparePath(e){const t=(e=[...this.splitfp(e)]).pop();let s=this;return e.length&&(s=this.get(e)),{target:s,path:e,last:t}}}const b=m.new(this.root);return{Directory:m,File:h,root:b}}toObject(){return{type:d.name,pathSeparator:this.PATH_SEPARATOR,root:this.root.toObject()}}static fromObject(e){return c(e.type===d.name,"Unable restore file system from object that is not a file system representation"),d.new(e.pathSeparator,l.Directory.fromObject(e.root))}static isFile(e){return"string"!=typeof e&&"File"===Reflect.get(e,Symbol.toStringTag)}}e.FileSystem=d,function(e){let t,s,r;!function(e){e[e.READ=4]="READ",e[e.WRITE=2]="WRITE",e[e.EXECUTE=1]="EXECUTE"}(t=e.Permissions||(e.Permissions={})),function(e){e[e.HIDDEN=1]="HIDDEN",e[e.TEMPORARY=2]="TEMPORARY"}(s=e.Attributes||(e.Attributes={})),function(e){e[e.UNLOCKED=0]="UNLOCKED",e[e.WRITE=1]="WRITE",e[e.READ=2]="READ"}(r=e.LockMode||(e.LockMode={}))}(d=e.FileSystem||(e.FileSystem={})),function(e){e.FileWriteStream=function(e,{mode:t="number"}={}){const s=new CountQueuingStrategy({highWaterMark:1});return"number"===t?new WritableStream({write(t){e.write(new Uint8Array([t]))}},s):new WritableStream({write(t){e.write(t)}},s)},e.DocumentWriteStream=function(e=globalThis.document,{mode:t="number"}={}){const s=new CountQueuingStrategy({highWaterMark:1}),r=new TextDecoder;return"number"===t?new WritableStream({write(t){e.write(r.decode(new Uint8Array([t]),{stream:!0}))}},s):new WritableStream({write(t){e.write(r.decode(t,{stream:!0}))}},s)},e.FileReadStream=function(e){return t=new Uint8Array(e.read()).values(),new ReadableStream({async pull(e){const{value:s,done:r}=await t.next();r?e.close():e.enqueue(s)}});var t}}(u=e.Streams||(e.Streams={})),e.download=function(e,t){var s;(function(e){return"string"!=typeof e&&"File"===Reflect.get(e,Symbol.toStringTag)})(e)&&(null!=t||(t=null!==(s=e.getName())&&void 0!==s?s:void 0),e=e.read()),e instanceof Blob||(e=new Blob([e]));const r=URL.createObjectURL(e);Object.assign(document.createElement("a"),{href:r,download:null!=t?t:"",onclick(){requestAnimationFrame((()=>URL.revokeObjectURL(r)))}}).click()}}(VFS||(VFS={}));